@using ProjectManagementSystem.ViewModels
@using ProjectManagementSystem.Data
@model IEnumerable<UserIndexViewModel>
@using Microsoft.AspNetCore.Identity;
@inject RoleManager<IdentityRole<int>> roleManager;
@inject UserManager<ApplicationUser> userManager;
@{
    ViewBag.Title = "用户列表";
}


<section class="section">
    <div class="row">
        <div class="col-lg-12">

            <div class="card">
                <div class="card-body">
                    <h2 class="card-title">用户信息</h2>

                    <!-- Table with stripped rows -->
                    <table id="mytable" class="table datatable">
                        <thead>
                            <tr>
                                <th scope="col">用户名</th>
                                <th scope="col">姓名</th>
                                <th scope="col">部门</th>
                                <th scope="col">职位</th>
                                <th scope="col">角色</th>
                                <th scope="col">年龄</th>
                                <th scope="col">工龄</th>
                                <th scope="col">操作</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var user in Model)
                            {
                                    var u = await userManager.FindByNameAsync(user.UserName);
                                    var roleNames = await userManager.GetRolesAsync(u);
                                var roleName = roleNames == null || roleNames.Count() == 0 ? "" : roleNames.First();
                                <tr>
                                    <td>@user.UserName</td>
                                    <td>@user.TrueName</td>
                                    <td>@user.Department</td>
                                    <td>@user.Job</td>
                                    <td>@roleName</td>
                                    <td>@user.Age</td>
                                    <td>@user.JobYear</td>
                                    <td>
                                        <row>
                                            <a asp-action="EditUser" asp-route-id="@user.Id" class="btn btn-outline-primary">编辑</a>
                                            <a asp-action="DeleteUser" asp-route-id="@user.Id" class="btn btn-outline-danger">删除</a>
                                        </row>
                                </tr>
                            }
                        </tbody>
                    </table>

                    <!-- End Table with stripped rows -->
                    <a asp-action="AddUser" class="btn btn-primary">添加用户</a>
                </div>
            </div>

        </div>
    </div>
</section>
@*<table class="table">
	<thead class="thead-dark">
		<tr>
			<th scope="col">ID</th>
			<th scope="col">用户名</th>
			<th scope="col">Email</th>
			<th scope="col">身份证</th>
			<th scope="col">出生日期</th>
			<th scope="col">操作</th>
		</tr>
	</thead>
	<tbody>
		@foreach (var u in Model)
		{
			<tr>
				<th scope="row">@u.Id</th>
				<td>@u.UserName</td>
				<td>@u.Email</td>
				<td>@u.IdCardNo</td>
				<td>@u.BirthDate</td>
				<td>
					<form asp-action="DeleteUser" asp-route-id="@u.Id" method="post">
						<a asp-action="EditUser" asp-route-id="@u.Id" class="btn btn-primary">编辑</a>
						<button type="submit" class="btn btn-danger"
								onclick="return confirm('确认删除？')">
							删除
						</button>
					</form>
				</td>
			</tr>
		}
	</tbody>
</table>

*@

@section Scripts{
    <script>

    </script>
                }