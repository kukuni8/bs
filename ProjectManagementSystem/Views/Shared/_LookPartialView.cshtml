@using ProjectManagementSystem.Data
@using ProjectManagementSystem.Models
@using ProjectManagementSystem.ViewModels
<div class="container">
    <!-- Reports -->
    <div class="col-12">
        <div class="card">

            <div class="filter">
                <a class="icon" href="#" data-bs-toggle="dropdown"><i class="bi bi-three-dots"></i></a>
                <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow">
                    <li class="dropdown-header text-start">
                        <h6>Filter</h6>
                    </li>

                    <li><a class="dropdown-item" id="filter-today" href="#">Today</a></li>
                    <li><a class="dropdown-item" id="filter-this-month" href="#">This Month</a></li>
                    <li><a class="dropdown-item" id="filter-this-year" href="#">This Year</a></li>

                </ul>
            </div>

            <div class="card-body">
                <h5 class="card-title">任务状态情况</h5>

                <!-- Line Chart -->
                <div id="chart"></div>
                <!-- End Line Chart -->

            </div>

        </div>
    </div>
    <!-- End Reports -->

    <div class="col-lg-6">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Column Chart</h5>

                <!-- Column Chart -->
                <div id="columnChart"></div>
                <!-- End Column Chart -->

            </div>
        </div>
    </div>
</div>

@section Scripts{
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            new ApexCharts(document.querySelector("#columnChart"), {
                series: [{
                    name: 'Net Profit',
                    data: [44, 55, 57, 56, 61, 58, 63, 60, 66]
                }, {
                    name: 'Revenue',
                    data: [76, 85, 101, 98, 87, 105, 91, 114, 94]
                }, {
                    name: 'Free Cash Flow',
                    data: [35, 41, 36, 26, 45, 48, 52, 53, 41]
                }],
                chart: {
                    type: 'bar',
                    height: 350
                },
                plotOptions: {
                    bar: {
                        horizontal: false,
                        columnWidth: '55%',
                        endingShape: 'rounded'
                    },
                },
                dataLabels: {
                    enabled: false
                },
                stroke: {
                    show: true,
                    width: 2,
                    colors: ['transparent']
                },
                xaxis: {
                    categories: ['Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct'],
                },
                yaxis: {
                    title: {
                        text: '$ (thousands)'
                    }
                },
                fill: {
                    opacity: 1
                },
                tooltip: {
                    y: {
                        formatter: function (val) {
                            return "$ " + val + " thousands"
                        }
                    }
                }
            }).render();
        });
    </script>

    <script>
        var chart;  // 创建一个全局变量来保存当前的图表

        $('#filter-today').click(function (e) {
            e.preventDefault();
            $.get('/Project/GetData?filter=Today', function (data) {
                renderChart(data);
            });
        });

        $('#filter-this-month').click(function (e) {
            e.preventDefault();
            $.get('/Project/GetData?filter=ThisMonth', function (data) {
                renderChart(data);
            });
        });

        $('#filter-this-year').click(function (e) {
            e.preventDefault();
            $.get('/Project/GetData?filter=ThisYear', function (data) {
                renderChart(data);
            });
        });

        function renderChart(data) {
            if (chart) {
                chart.destroy();  // 如果已经存在一个图表，先销毁它
            }

            // 处理数据，使其满足 ApexCharts 的要求
            var series = data.map(function (item) {
                return {
                    name: item.name,
                    data: item.data.map(function (d) {
                        return { x: d.x, y: d.y }
                    }),
                    color: item.color, // 颜色字段
                };
            });

            var options = {
                series: series,
                chart: {
                    height: 350,
                    type: 'area'
                },
                dataLabels: {
                    enabled: false
                },
                stroke: {
                    curve: 'smooth'
                },
                xaxis: {
                    type: 'datetime'
                },
                tooltip: {
                    x: {
                        format: 'dd/MM/yy HH:mm'
                    },
                },
            };

            chart = new ApexCharts(document.querySelector("#chart"), options);
            chart.render();
        }


        // 页面加载完成后，自动触发“这个月”的点击事件
        $(document).ready(function () {
            $('#filter-this-month').trigger('click');
        });
    </script>
                    }