@using Microsoft.AspNetCore.Identity;
@using ProjectManagementSystem.Data;
@using ProjectManagementSystem.ViewModels
@model ProjectDetailViewModel
@inject ApplicationDbContext applicationDbContext
@inject UserManager<ApplicationUser> userManager
<style>
    .priority {
        font-weight: bold;
        display: inline-block;
        padding: 2px 8px;
        border-radius: 3px;
        text-align: center;
    }

    .priority-low {
        background-color: #28a745;
        color: white;
    }

    .priority-medium {
        background-color: #ffc107;
        color: white;
    }

    .priority-high {
        background-color: #dc3545;
        color: white;
    }

    .status-1 {
        color: #b3b3b3; /* 淡灰色 */
    }

    .status-2 {
        color: #add8e6; /* 淡蓝色 */
    }

    .status-3 {
        color: #FF8C66; /* 淡橙色 */
    }

    .status-label {
        font-size: 0.85rem;
        color: #6c757d;
    }

    .text-priority {
        color: #6c757d;
    }

</style>
<style>
    .status-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 20px;
    }

    .status-text {
        font-size: 1.1rem;
        font-weight: 600;
    }

    .add-button {
        font-size: 1.5rem;
        background-color: #ffffff;
        border: 2px solid #dee2e6;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        line-height: 36px;
        text-align: center;
        color: #495057;
        transition: 0.2s;
    }

        .add-button:hover {
            background-color: #f8f9fa;
            border-color: #6c757d;
            color: #6c757d;
        }
</style>
<style>
    .custom-card-body {
        display: flex;
        align-items: center;
        height: 100%; /* 设置 custom-card-body 高度为 100%，以便填充整个卡片 */
    }
</style>
<style>
    .custom-td {
        width: 16.66%; /* 设置每列的宽度占总宽度的 1/6 */
        text-align: center; /* 设置文本居中对齐 */
    }
</style>


<style>
    .list-group-item {
        display: flex;
        flex-direction: column;
    }

        .list-group-item .time {
            font-size: 12px;
        }

        .list-group-item .content {
            display: flex;
            font-size: 14px;
        }
</style>
<style>
    .card-icon-green {
        color: #2eca6a;
        background: #e0f8e9;
        font-size: 32px;
        line-height: 0;
        width: 64px;
        height: 64px;
        flex-shrink: 0;
        flex-grow: 0;
    }

    .card-icon-blue {
        color: #4d79ff;
        background: #e6e6ff;
        font-size: 32px;
        line-height: 0;
        width: 64px;
        height: 64px;
        flex-shrink: 0;
        flex-grow: 0;
    }


    .card-icon-red {
        color: #ff4d4d;
        background: #ffe6e6;
        font-size: 32px;
        line-height: 0;
        width: 64px;
        height: 64px;
        flex-shrink: 0;
        flex-grow: 0;
    }

</style>

<style>

    .activity-item {
        align-items: center;
    }

    .time-container {
        width: 160px;
        text-align: right;
    }

    .activity-badge {
        margin-left: 20px;
        margin-right: 10px;
    }

</style>
<style>
    .custom-td {
        width: 16.66%; /* 设置每列的宽度占总宽度的 1/6 */
        text-align: center; /* 设置文本居中对齐 */
    }
</style>

<style>
    .notification {
        display: flex;
        align-items: center;
        justify-content: space-between;
    }
</style>
<div class="card">
    <div class="card-body">
        <h5 class="card-title">@Model.ProjectEditViewModel.Name</h5>

        <!-- Bordered Tabs -->
        <ul class="nav nav-tabs nav-tabs-bordered" id="borderedTab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="look-tab" data-bs-toggle="tab" data-bs-target="#bordered-looks" type="button" role="tab" aria-controls="home" aria-selected="true">总览</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="notice-tab" data-bs-toggle="tab" data-bs-target="#bordered-notices" type="button" role="tab" aria-controls="home" aria-selected="true">通知</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="chat-tab" data-bs-toggle="tab" data-bs-target="#bordered-chats" type="button" role="tab" aria-controls="home" aria-selected="true">交流</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="mission-tab" data-bs-toggle="tab" data-bs-target="#bordered-missions" type="button" role="tab" aria-controls="home" aria-selected="true">任务</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="risk-tab" data-bs-toggle="tab" data-bs-target="#bordered-risks" type="button" role="tab" aria-controls="profile" aria-selected="false">风险</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="defect-tab" data-bs-toggle="tab" data-bs-target="#bordered-defects" type="button" role="tab" aria-controls="home" aria-selected="true">缺陷</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="check-tab" data-bs-toggle="tab" data-bs-target="#bordered-checks" type="button" role="tab" aria-controls="home" aria-selected="true">审核</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="book-tab" data-bs-toggle="tab" data-bs-target="#bordered-books" type="button" role="tab" aria-controls="home" aria-selected="true">文档</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="resource-tab" data-bs-toggle="tab" data-bs-target="#bordered-resources" type="button" role="tab" aria-controls="home" aria-selected="true">资源</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="user-tab" data-bs-toggle="tab" data-bs-target="#bordered-users" type="button" role="tab" aria-controls="profile" aria-selected="false">人员</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="project-tab" data-bs-toggle="tab" data-bs-target="#bordered-editProject" type="button" role="tab" aria-controls="profile" aria-selected="false">信息</button>
            </li>
        </ul>
        <div class="tab-content pt-2" id="borderedTabContent">
            <div class="tab-pane fade show active" id="bordered-looks" role="tabpanel" aria-labelledby="look-tab">
                <div class="container">
                    <!-- Reports -->
                    <div class="col-12">
                        <div class="card">

                            <div class="filter">
                                <a class="icon" href="#" data-bs-toggle="dropdown"><i class="bi bi-three-dots"></i></a>
                                <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow">
                                    <li class="dropdown-header text-start">
                                        <h6>Filter</h6>
                                    </li>

                                    <li><a class="dropdown-item" href="#">Today</a></li>
                                    <li><a class="dropdown-item" href="#">This Month</a></li>
                                    <li><a class="dropdown-item" href="#">This Year</a></li>
                                </ul>
                            </div>

                            <div class="card-body">
                                <h5 class="card-title">任务状态情况</h5>

                                <!-- Line Chart -->
                                <div id="chart"></div>
                                <!-- End Line Chart -->

                            </div>

                        </div>
                    </div>
                    <!-- End Reports -->

                    <div class="col-lg-6">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">Column Chart</h5>

                                <!-- Column Chart -->
                                <div id="columnChart"></div>
                                <!-- End Column Chart -->

                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="tab-pane fade" id="bordered-notices" role="tabpanel" aria-labelledby="notice-tab">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">通知列表</h5>
                        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#newNotice">
                            发通知
                        </button>
                        <div class="modal fade" id="newNotice" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <form asp-action="AddNotice" asp-controller="Notice" method="post">
                                        <input asp-for="@Model.NoticeAddViewModel.ProjectId" value="@Model.CurProject.Id" hidden>
                                        <div class="modal-header">
                                            <h1 class="modal-title fs-5" id="exampleModalLabel">新通知</h1>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                        </div>
                                        <div class="modal-body">
                                            <textarea asp-for="@Model.NoticeAddViewModel.Information"></textarea>
                                            <div class="form-check">
                                                <input asp-for="@Model.NoticeAddViewModel.IsInfo" class="form-check-input" name="flexRadioDefault" id="flexRadioDefault1">
                                                <label class="form-check-label" for="flexRadioDefault1">
                                                    普通
                                                </label>
                                            </div>
                                            <div class="form-check">
                                                <input asp-for="@Model.NoticeAddViewModel.IsWarning" class="form-check-input" name="flexRadioDefault" id="flexRadioDefault2" checked>
                                                <label class="form-check-label" for="flexRadioDefault2">
                                                    警告
                                                </label>
                                            </div>
                                            <div class="form-check">
                                                <input asp-for="@Model.NoticeAddViewModel.IsDanger" class="form-check-input" name="flexRadioDefault" id="flexRadioDefault2" checked>
                                                <label class="form-check-label" for="flexRadioDefault2">
                                                    危险
                                                </label>
                                            </div>
                                            <div class="form-check">
                                                <input asp-for="@Model.NoticeAddViewModel.IsSuccess" class="form-check-input" name="flexRadioDefault" id="flexRadioDefault2" checked>
                                                <label class="form-check-label" for="flexRadioDefault2">
                                                    提醒
                                                </label>
                                            </div>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭</button>
                                            <button type="submit" class="btn btn-primary">发送</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                        <div id="notificationList">
                        </div>
                        @foreach (var notice in Model.Notices)
                        {
                            var coor = "alert-success";
                            var ic = "bi bi-check-circle me-1";
                            var bt = "btn-success";
                            if (notice.NoticeType == NoticeType.Info)
                            {
                                coor = "alert-info";
                                ic = "bi bi-info-circle me-1";
                                bt = "btn-info";
                            }
                            if (notice.NoticeType == NoticeType.Warning)
                            {
                                coor = "alert-warning";
                                ic = "bi bi-exclamation-triangle me-1";
                                bt = "btn-warning";
                            }

                            if (notice.NoticeType == NoticeType.Danger)
                            {
                                coor = "alert-danger";
                                ic = "bi bi-exclamation-octagon me-1";
                                bt = "btn-danger";
                            }
                            <div class="alert @coor alert-dismissible fade show notification" role="alert">
                                <div class="notification-info">
                                    <i class="@ic"></i>
                                    A simple success alert with icon—check it out!
                                </div>
                                <button type="button" class="btn @bt btn-sm mark-as-read" data-bs-toggle="modal" data-bs-target="#@("looktz" + notice.Id)">详情</button>
                                <div class="modal fade" id="@("looktz" + notice.Id)" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h1 class="modal-title fs-5" id="exampleModalLabel">通知详情</h1>
                                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                            </div>
                                            <div class="modal-body">
                                                <textarea>@notice.Information</textarea>
                                                <label>@notice.Putforward</label>
                                                <label>@notice.CreateTime.ToString("yyyy-MM-dd")</label>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>
            <div class="tab-pane fade" id="bordered-chats" role="tabpanel" aria-labelledby="chat-tab">
                <div class="container">
                    <div class="row">&nbsp;</div>
                    <div class="row">
                        <div class="col-2">User:</div>
                        <div class="col-4"><input type="text" id="userInput" /></div>
                    </div>
                    <div class="row">
                        <div class="col-2">Message:</div>
                        <div class="col-4"><input type="text" id="messageInput" /></div>
                    </div>
                    <div class="row">&nbsp;</div>
                    <div class="row">
                        <div class="col-6"><input type="button" id="sendButton" value="Send Message" /></div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-12">
                        <hr />
                    </div>
                </div>

                <div class="row">
                    <div class="col-6">
                        <ul id="messagesList"></ul>
                    </div>
                </div>
            </div>
            <div class="tab-pane fade" id="bordered-missions" role="tabpanel" aria-labelledby="mission-tab">
                <div class="container">
                    <div class="row">
                        <div class="col-3">
                            <div class="card">
                                <div class="card-body status-container">
                                    <label class="status-text status-1">待处理（@Model.ProjectMissionIndexViewModel.UntreatedMissions.Count()）</label>
                                    <button type="button" class="add-button" data-bs-toggle="modal" data-bs-target="#addModal">+</button>
                                </div>
                            </div>
                            @foreach (var mission in Model.ProjectMissionIndexViewModel.UntreatedMissions)
                            {
                                string cardClass = "priority-medium";
                                if (mission.Priority == MissionPriority.较低)
                                {
                                    cardClass = "priority-low";
                                }
                                else if (mission.Priority == MissionPriority.紧急)
                                {
                                    cardClass = "priority-high";
                                }

                                string statusClass = "status-1";
                                if (mission.Status == MissionStatus.待处理)
                                {
                                    statusClass = "status-1";
                                }
                                else if (mission.Status == MissionStatus.进行中)
                                {
                                    statusClass = "status-2";
                                }
                                else if (mission.Status == MissionStatus.已完成)
                                {
                                    statusClass = "status-3";
                                }

                                <div class="card mb-3 mission-card" data-id="@mission.Id">
                                    <a href="#" data-bs-toggle="modal" data-bs-target="#@mission.Name">
                                        <div class="card-body">
                                            <h5 class="card-title @statusClass">@mission.Name</h5>
                                            <h6 class="card-subtitle mb-2 text-muted">执行人：@mission.Executors.First()</h6>
                                            <span class="text-priority">优先级: </span><span class="priority @cardClass">@mission.Priority</span>
                                            <!-- 其他内容 -->
                                        </div>
                                    </a>
                                </div>

                                <!-- EditModal -->
                                <div class="modal fade bs-example-modal-lg my-modal" id="@mission.Name" tabindex="-1" aria-labelledby="editModalLabel"
                                     aria-hidden="true" data-scrollable-div="@mission.Name">
                                    <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
                                        <div class="modal-body">
                                            <div class="container-fluid">
                                                <div class="modal-content">
                                                    <div class="modal-header">
                                                        <h5 class="modal-title" id="editModalLabel">编辑任务</h5>
                                                        <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                                aria-label="Close"></button>
                                                    </div>
                                                    <form class="needs-validation" novalidate="" asp-action="EditMission" method="post">
                                                        <div class="modal-body">
                                                            <div class="container">
                                                                <div class="row">
                                                                    <div class="col-6" style="height:550px;">
                                                                        <div class="form-group row">
                                                                            <input asp-for="@Model.EditMission.Id" value="@mission.Id" hidden>
                                                                            <label asp-for="@Model.EditMission.Name" class="col-sm-2"></label>
                                                                            <div class="col-sm-10">
                                                                                <input value="@mission.Name" type="text" class="form-control" asp-for="@Model.EditMission.Name" required>
                                                                                <div class="invalid-feedback">请输入任务的名称</div>
                                                                            </div>
                                                                        </div>
                                                                        <br />
                                                                        <div class="form-group row">
                                                                            <label asp-for="@Model.EditMission.ProjectName" class="col-sm-2"></label>
                                                                            <div class="col-sm-10">
                                                                                <input type="text" value="@Model.CurProject.Name" class="form-control" asp-for="@Model.EditMission.ProjectName" readonly>
                                                                                <div class="invalid-feedback">请输入任务的所属项目</div>
                                                                            </div>
                                                                        </div>
                                                                        <br />
                                                                        <div class="form-group row">
                                                                            <label asp-for="@Model.EditMission.Description" class="col-sm-2"></label>
                                                                            <div class="col-sm-10">
                                                                                <textarea name="EditMission.Description" class="form-control" aria-label="With textarea">@mission.Description</textarea>
                                                                                <span class="invalid" asp-validation-for="@Model.EditMission.Description"></span>
                                                                            </div>
                                                                        </div>
                                                                        <br />
                                                                        <div class="form-group row">
                                                                            <label asp-for="@Model.EditMission.CreateDate" class="col-sm-2"></label>
                                                                            <div class="col-sm-10">
                                                                                <input value="@mission.CreateDate.ToString("yyyy-MM-dd")" class="form-control" asp-for="@Model.EditMission.CreateDate" required readonly>
                                                                                <div class="invalid-feedback">请输入任务的创建日期</div>
                                                                            </div>
                                                                        </div>
                                                                        <br />
                                                                        <div class="form-group row">
                                                                            <label asp-for="@Model.EditMission.Deadline" class="col-sm-2"></label>
                                                                            <div class="col-sm-10">
                                                                                <input value="@mission.Deadline.ToString("yyyy-MM-dd")" class="form-control" asp-for="@Model.EditMission.Deadline" required>
                                                                                <div class="invalid-feedback">请输入任务的截止日期</div>
                                                                            </div>
                                                                        </div>
                                                                        <br />
                                                                        <div class="form-group row">
                                                                            <label asp-for="@Model.EditMission.Status" class="col-sm-2"></label>
                                                                            <div class="col-sm-10">
                                                                                <select asp-for="@Model.EditMission.Status" class="form-control valid">
                                                                                    @foreach (var status in @Html.GetEnumSelectList<MissionStatus>())
                                                                                    {
                                                                                        if (status.Value == ((int)mission.Status).ToString())
                                                                                        {
                                                                                            <option value="@((MissionStatus)int.Parse(status.Value))" selected>@((MissionStatus)int.Parse(status.Value))</option>
                                                                                        }
                                                                                        else
                                                                                        {
                                                                                            <option value="@((MissionStatus)int.Parse(status.Value))">@((MissionStatus)int.Parse(status.Value))</option>
                                                                                        }
                                                                                    }
                                                                                </select>
                                                                                <span class="invalid" asp-validation-for="@Model.EditMission.Status"></span>
                                                                            </div>
                                                                        </div>
                                                                        <br />
                                                                        <div class="form-group row">
                                                                            <label asp-for="@Model.EditMission.Priority" class="col-sm-2"></label>
                                                                            <div class="col-sm-10">
                                                                                <select asp-for="@Model.EditMission.Priority" class="form-control valid">
                                                                                    @foreach (var priority in @Html.GetEnumSelectList<MissionPriority>())
                                                                                    {
                                                                                        if (priority.Value == ((int)mission.Priority).ToString())
                                                                                        {
                                                                                            <option value="@((MissionPriority)int.Parse(priority.Value))" selected>@((MissionPriority)int.Parse(priority.Value))</option>
                                                                                        }
                                                                                        else
                                                                                        {
                                                                                            <option value="@((MissionPriority)int.Parse(priority.Value))">@((MissionPriority)int.Parse(priority.Value))</option>
                                                                                        }
                                                                                    }
                                                                                </select>
                                                                                <span class="invalid" asp-validation-for="@Model.EditMission.Priority"></span>
                                                                            </div>
                                                                        </div>
                                                                        <br />
                                                                        <div class="form-group row">
                                                                            <label asp-for="@Model.EditMission.Executors" class="col-sm-2"></label>
                                                                            <div class="col-sm-10">
                                                                                <select id="missionExecutor" asp-for="@Model.EditMission.Executors" class="selectpicker form-control valid" data-live-search="true" multiple required="">
                                                                                    @{
                                                                                        foreach (var item in Model.UsersInTheProject)
                                                                                        {
                                                                                            <option value="@item.UserName" selected="@mission.Executors.Contains(item.UserName)">@item.UserName</option>
                                                                                        }
                                                                                    }
                                                                                </select>

                                                                                <div class="invalid-feedback">请选择执行人</div>
                                                                            </div>
                                                                        </div>
                                                                        <br />
                                                                    </div>
                                                                    <div class="col-6">
                                                                        <div class="overflow-auto" style="height:400px;" id="scrollableDiv">
                                                                            <ul class="list-group">
                                                                                @foreach (var dialogue in mission.Dialogues)
                                                                                {
                                                                                    <li class="list-group-item">
                                                                                        <div class="time">@dialogue.CreateDate</div>
                                                                                        <div class="content">
                                                                                            <div class="part1">@dialogue.Speaker</div>
                                                                                            <div class="part2">:</div>
                                                                                            <div class="part3">@dialogue.Content</div>
                                                                                        </div>
                                                                                    </li>
                                                                                }
                                                                            </ul>
                                                                        </div>
                                                                        <div class="form-floating">
                                                                            <textarea asp-for="@Model.EditMission.Content" class="form-control" id="floatingName" placeholder="写点记录" style="height:150px;"></textarea>
                                                                            <label for="floatingName">任务记录</label>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="modal-footer">
                                                            <button type="reset" class="btn btn-secondary" data-bs-dismiss="modal">返回</button>
                                                            <button type="submit" class="btn btn-primary">提交</button>
                                                            <a asp-action="DeleteMission" class="btn btn-danger" asp-route-id="@mission.Id">删除</a>
                                                        </div>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                        <div class="col-3">
                            <div class="card">
                                <div class="card-body status-container">
                                    <label class="status-text status-2">进行中（@Model.ProjectMissionIndexViewModel.ProcessOnMissions.Count()）</label>
                                    <button type="button" class="add-button" data-bs-toggle="modal" data-bs-target="#addModal">+</button>
                                </div>
                            </div>
                            @foreach (var mission in Model.ProjectMissionIndexViewModel.ProcessOnMissions)
                            {
                                string cardClass = "priority-medium";
                                if (mission.Priority == MissionPriority.较低)
                                {
                                    cardClass = "priority-low";
                                }
                                else if (mission.Priority == MissionPriority.紧急)
                                {
                                    cardClass = "priority-high";
                                }

                                string statusClass = "status-1";
                                if (mission.Status == MissionStatus.待处理)
                                {
                                    statusClass = "status-1";
                                }
                                else if (mission.Status == MissionStatus.进行中)
                                {
                                    statusClass = "status-2";
                                }
                                else if (mission.Status == MissionStatus.已完成)
                                {
                                    statusClass = "status-3";
                                }

                                <div class="card mb-3 mission-card" data-id="@mission.Id">
                                    <a href="#" data-bs-toggle="modal" data-bs-target="#@mission.Name">
                                        <div class="card-body">
                                            <h5 class="card-title @statusClass">@mission.Name</h5>
                                            <h6 class="card-subtitle mb-2 text-muted">执行人：@mission.Executors.First()</h6>
                                            <span class="text-priority">优先级: </span><span class="priority @cardClass">@mission.Priority</span>
                                            <!-- 其他内容 -->
                                        </div>
                                    </a>
                                </div>

                                <!-- EditModal -->
                                <div class="modal fade bs-example-modal-lg my-modal" id="@mission.Name" tabindex="-1" aria-labelledby="editModalLabel"
                                     aria-hidden="true" data-scrollable-div="@mission.Name">
                                    <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
                                        <div class="modal-body">
                                            <div class="container-fluid">
                                                <div class="modal-content">
                                                    <div class="modal-header">
                                                        <h5 class="modal-title" id="editModalLabel">编辑任务</h5>
                                                        <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                                aria-label="Close"></button>
                                                    </div>
                                                    <form class="needs-validation" novalidate="" asp-action="EditMission" method="post">
                                                        <div class="modal-body">
                                                            <div class="container">
                                                                <div class="row">
                                                                    <div class="col-6" style="height:550px;">
                                                                        <div class="form-group row">
                                                                            <input asp-for="@Model.EditMission.Id" value="@mission.Id" hidden>
                                                                            <label asp-for="@Model.EditMission.Name" class="col-sm-2"></label>
                                                                            <div class="col-sm-10">
                                                                                <input value="@mission.Name" type="text" class="form-control" asp-for="@Model.EditMission.Name" required>
                                                                                <div class="invalid-feedback">请输入任务的名称</div>
                                                                            </div>
                                                                        </div>
                                                                        <br />
                                                                        <div class="form-group row">
                                                                            <label asp-for="@Model.EditMission.ProjectName" class="col-sm-2"></label>
                                                                            <div class="col-sm-10">
                                                                                <input type="text" value="@Model.CurProject.Name" class="form-control" asp-for="@Model.EditMission.ProjectName" readonly>
                                                                                <div class="invalid-feedback">请输入任务的所属项目</div>
                                                                            </div>
                                                                        </div>
                                                                        <br />
                                                                        <div class="form-group row">
                                                                            <label asp-for="@Model.EditMission.Description" class="col-sm-2"></label>
                                                                            <div class="col-sm-10">
                                                                                <textarea name="EditMission.Description" class="form-control" aria-label="With textarea">@mission.Description</textarea>
                                                                                <span class="invalid" asp-validation-for="@Model.EditMission.Description"></span>
                                                                            </div>
                                                                        </div>
                                                                        <br />
                                                                        <div class="form-group row">
                                                                            <label asp-for="@Model.EditMission.CreateDate" class="col-sm-2"></label>
                                                                            <div class="col-sm-10">
                                                                                <input value="@mission.CreateDate.ToString("yyyy-MM-dd")" class="form-control" asp-for="@Model.EditMission.CreateDate" required readonly>
                                                                                <div class="invalid-feedback">请输入任务的创建日期</div>
                                                                            </div>
                                                                        </div>
                                                                        <br />
                                                                        <div class="form-group row">
                                                                            <label asp-for="@Model.EditMission.Deadline" class="col-sm-2"></label>
                                                                            <div class="col-sm-10">
                                                                                <input value="@mission.Deadline.ToString("yyyy-MM-dd")" class="form-control" asp-for="@Model.EditMission.Deadline" required>
                                                                                <div class="invalid-feedback">请输入任务的截止日期</div>
                                                                            </div>
                                                                        </div>
                                                                        <br />
                                                                        <div class="form-group row">
                                                                            <label asp-for="@Model.EditMission.Status" class="col-sm-2"></label>
                                                                            <div class="col-sm-10">
                                                                                <select asp-for="@Model.EditMission.Status" class="form-control valid">
                                                                                    @foreach (var status in @Html.GetEnumSelectList<MissionStatus>())
                                                                                    {
                                                                                        if (status.Value == ((int)mission.Status).ToString())
                                                                                        {
                                                                                            <option value="@((MissionStatus)int.Parse(status.Value))" selected>@((MissionStatus)int.Parse(status.Value))</option>
                                                                                        }
                                                                                        else
                                                                                        {
                                                                                            <option value="@((MissionStatus)int.Parse(status.Value))">@((MissionStatus)int.Parse(status.Value))</option>
                                                                                        }
                                                                                    }
                                                                                </select>
                                                                                <span class="invalid" asp-validation-for="@Model.EditMission.Status"></span>
                                                                            </div>
                                                                        </div>
                                                                        <br />
                                                                        <div class="form-group row">
                                                                            <label asp-for="@Model.EditMission.Priority" class="col-sm-2"></label>
                                                                            <div class="col-sm-10">
                                                                                <select asp-for="@Model.EditMission.Priority" class="form-control valid">
                                                                                    @foreach (var priority in @Html.GetEnumSelectList<MissionPriority>())
                                                                                    {
                                                                                        if (priority.Value == ((int)mission.Priority).ToString())
                                                                                        {
                                                                                            <option value="@((MissionPriority)int.Parse(priority.Value))" selected>@((MissionPriority)int.Parse(priority.Value))</option>
                                                                                        }
                                                                                        else
                                                                                        {
                                                                                            <option value="@((MissionPriority)int.Parse(priority.Value))">@((MissionPriority)int.Parse(priority.Value))</option>
                                                                                        }
                                                                                    }
                                                                                </select>
                                                                                <span class="invalid" asp-validation-for="@Model.EditMission.Priority"></span>
                                                                            </div>
                                                                        </div>
                                                                        <br />
                                                                        <div class="form-group row">
                                                                            <label asp-for="@Model.EditMission.Executors" class="col-sm-2"></label>
                                                                            <div class="col-sm-10">
                                                                                <select id="missionExecutor" asp-for="@Model.EditMission.Executors" class="selectpicker form-control valid" data-live-search="true" multiple required="">
                                                                                    @{
                                                                                        foreach (var item in Model.UsersInTheProject)
                                                                                        {
                                                                                            <option value="@item.UserName" selected="@mission.Executors.Contains(item.UserName)">@item.UserName</option>
                                                                                        }
                                                                                    }
                                                                                </select>

                                                                                <div class="invalid-feedback">请选择执行人</div>
                                                                            </div>
                                                                        </div>
                                                                        <br />
                                                                    </div>
                                                                    <div class="col-6">
                                                                        <div class="overflow-auto" style="height:400px;" id="scrollableDiv">
                                                                            <ul class="list-group">
                                                                                @foreach (var dialogue in mission.Dialogues)
                                                                                {
                                                                                    <li class="list-group-item">
                                                                                        <div class="time">@dialogue.CreateDate</div>
                                                                                        <div class="content">
                                                                                            <div class="part1">@dialogue.Speaker</div>
                                                                                            <div class="part2">:</div>
                                                                                            <div class="part3">@dialogue.Content</div>
                                                                                        </div>
                                                                                    </li>
                                                                                }
                                                                            </ul>
                                                                        </div>
                                                                        <div class="form-floating">
                                                                            <textarea asp-for="@Model.EditMission.Content" class="form-control" id="floatingName" placeholder="写点记录" style="height:150px;"></textarea>
                                                                            <label for="floatingName">任务记录</label>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="modal-footer">
                                                            <button type="reset" class="btn btn-secondary" data-bs-dismiss="modal">返回</button>
                                                            <button type="submit" class="btn btn-primary">提交</button>
                                                            <a asp-action="DeleteMission" class="btn btn-danger" asp-route-id="@mission.Id">删除</a>
                                                        </div>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                        <div class="col-3">
                            <div class="card">
                                <div class="card-body status-container">
                                    <label class="status-text status-3">已完成（@Model.ProjectMissionIndexViewModel.FinishedMissions.Count()）</label>
                                    <button type="button" class="add-button" data-bs-toggle="modal" data-bs-target="#addModal">+</button>
                                </div>
                            </div>
                            @foreach (var mission in Model.ProjectMissionIndexViewModel.FinishedMissions)
                            {
                                string cardClass = "priority-medium";
                                if (mission.Priority == MissionPriority.较低)
                                {
                                    cardClass = "priority-low";
                                }
                                else if (mission.Priority == MissionPriority.紧急)
                                {
                                    cardClass = "priority-high";
                                }

                                string statusClass = "status-1";
                                if (mission.Status == MissionStatus.待处理)
                                {
                                    statusClass = "status-1";
                                }
                                else if (mission.Status == MissionStatus.进行中)
                                {
                                    statusClass = "status-2";
                                }
                                else if (mission.Status == MissionStatus.已完成)
                                {
                                    statusClass = "status-3";
                                }

                                <div class="card mb-3 mission-card" data-id="@mission.Id">
                                    <a href="#" data-bs-toggle="modal" data-bs-target="#@mission.Name">
                                        <div class="card-body">
                                            <h5 class="card-title @statusClass">@mission.Name</h5>
                                            <h6 class="card-subtitle mb-2 text-muted">执行人：@mission.Executors.First()</h6>
                                            <span class="text-priority">优先级: </span><span class="priority @cardClass">@mission.Priority</span>
                                            <!-- 其他内容 -->
                                        </div>
                                    </a>
                                </div>

                                <!-- EditModal -->
                                <div class="modal fade bs-example-modal-lg my-modal" id="@mission.Name" tabindex="-1" aria-labelledby="editModalLabel"
                                     aria-hidden="true" data-scrollable-div="@mission.Name">
                                    <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
                                        <div class="modal-body">
                                            <div class="container-fluid">
                                                <div class="modal-content">
                                                    <div class="modal-header">
                                                        <h5 class="modal-title" id="editModalLabel">编辑任务</h5>
                                                        <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                                aria-label="Close"></button>
                                                    </div>
                                                    <form class="needs-validation" novalidate="" asp-action="EditMission" method="post">
                                                        <div class="modal-body">
                                                            <div class="container">
                                                                <div class="row">
                                                                    <div class="col-6" style="height:550px;">
                                                                        <div class="form-group row">
                                                                            <input asp-for="@Model.EditMission.Id" value="@mission.Id" hidden>
                                                                            <label asp-for="@Model.EditMission.Name" class="col-sm-2"></label>
                                                                            <div class="col-sm-10">
                                                                                <input value="@mission.Name" type="text" class="form-control" asp-for="@Model.EditMission.Name" required>
                                                                                <div class="invalid-feedback">请输入任务的名称</div>
                                                                            </div>
                                                                        </div>
                                                                        <br />
                                                                        <div class="form-group row">
                                                                            <label asp-for="@Model.EditMission.ProjectName" class="col-sm-2"></label>
                                                                            <div class="col-sm-10">
                                                                                <input type="text" value="@Model.CurProject.Name" class="form-control" asp-for="@Model.EditMission.ProjectName" readonly>
                                                                                <div class="invalid-feedback">请输入任务的所属项目</div>
                                                                            </div>
                                                                        </div>
                                                                        <br />
                                                                        <div class="form-group row">
                                                                            <label asp-for="@Model.EditMission.Description" class="col-sm-2"></label>
                                                                            <div class="col-sm-10">
                                                                                <textarea name="EditMission.Description" class="form-control" aria-label="With textarea">@mission.Description</textarea>
                                                                                <span class="invalid" asp-validation-for="@Model.EditMission.Description"></span>
                                                                            </div>
                                                                        </div>
                                                                        <br />
                                                                        <div class="form-group row">
                                                                            <label asp-for="@Model.EditMission.CreateDate" class="col-sm-2"></label>
                                                                            <div class="col-sm-10">
                                                                                <input value="@mission.CreateDate.ToString("yyyy-MM-dd")" class="form-control" asp-for="@Model.EditMission.CreateDate" required readonly>
                                                                                <div class="invalid-feedback">请输入任务的创建日期</div>
                                                                            </div>
                                                                        </div>
                                                                        <br />
                                                                        <div class="form-group row">
                                                                            <label asp-for="@Model.EditMission.Deadline" class="col-sm-2"></label>
                                                                            <div class="col-sm-10">
                                                                                <input value="@mission.Deadline.ToString("yyyy-MM-dd")" class="form-control" asp-for="@Model.EditMission.Deadline" required>
                                                                                <div class="invalid-feedback">请输入任务的截止日期</div>
                                                                            </div>
                                                                        </div>
                                                                        <br />
                                                                        <div class="form-group row">
                                                                            <label asp-for="@Model.EditMission.Status" class="col-sm-2"></label>
                                                                            <div class="col-sm-10">
                                                                                <select asp-for="@Model.EditMission.Status" class="form-control valid">
                                                                                    @foreach (var status in @Html.GetEnumSelectList<MissionStatus>())
                                                                                    {
                                                                                        if (status.Value == ((int)mission.Status).ToString())
                                                                                        {
                                                                                            <option value="@((MissionStatus)int.Parse(status.Value))" selected>@((MissionStatus)int.Parse(status.Value))</option>
                                                                                        }
                                                                                        else
                                                                                        {
                                                                                            <option value="@((MissionStatus)int.Parse(status.Value))">@((MissionStatus)int.Parse(status.Value))</option>
                                                                                        }
                                                                                    }
                                                                                </select>
                                                                                <span class="invalid" asp-validation-for="@Model.EditMission.Status"></span>
                                                                            </div>
                                                                        </div>
                                                                        <br />
                                                                        <div class="form-group row">
                                                                            <label asp-for="@Model.EditMission.Priority" class="col-sm-2"></label>
                                                                            <div class="col-sm-10">
                                                                                <select asp-for="@Model.EditMission.Priority" class="form-control valid">
                                                                                    @foreach (var priority in @Html.GetEnumSelectList<MissionPriority>())
                                                                                    {
                                                                                        if (priority.Value == ((int)mission.Priority).ToString())
                                                                                        {
                                                                                            <option value="@((MissionPriority)int.Parse(priority.Value))" selected>@((MissionPriority)int.Parse(priority.Value))</option>
                                                                                        }
                                                                                        else
                                                                                        {
                                                                                            <option value="@((MissionPriority)int.Parse(priority.Value))">@((MissionPriority)int.Parse(priority.Value))</option>
                                                                                        }
                                                                                    }
                                                                                </select>
                                                                                <span class="invalid" asp-validation-for="@Model.EditMission.Priority"></span>
                                                                            </div>
                                                                        </div>
                                                                        <br />
                                                                        <div class="form-group row">
                                                                            <label asp-for="@Model.EditMission.Executors" class="col-sm-2"></label>
                                                                            <div class="col-sm-10">
                                                                                <select id="missionExecutor" asp-for="@Model.EditMission.Executors" class="selectpicker form-control valid" data-live-search="true" multiple required="">
                                                                                    @{
                                                                                        foreach (var item in Model.UsersInTheProject)
                                                                                        {
                                                                                            <option value="@item.UserName" selected="@mission.Executors.Contains(item.UserName)">@item.UserName</option>
                                                                                        }
                                                                                    }
                                                                                </select>

                                                                                <div class="invalid-feedback">请选择执行人</div>
                                                                            </div>
                                                                        </div>
                                                                        <br />
                                                                    </div>
                                                                    <div class="col-6">
                                                                        <div class="overflow-auto" style="height:400px;" id="scrollableDiv">
                                                                            <ul class="list-group">
                                                                                @foreach (var dialogue in mission.Dialogues)
                                                                                {
                                                                                    <li class="list-group-item">
                                                                                        <div class="time">@dialogue.CreateDate</div>
                                                                                        <div class="content">
                                                                                            <div class="part1">@dialogue.Speaker</div>
                                                                                            <div class="part2">:</div>
                                                                                            <div class="part3">@dialogue.Content</div>
                                                                                        </div>
                                                                                    </li>
                                                                                }
                                                                            </ul>
                                                                        </div>
                                                                        <div class="form-floating">
                                                                            <textarea asp-for="@Model.EditMission.Content" class="form-control" id="floatingName" placeholder="写点记录" style="height:150px;"></textarea>
                                                                            <label for="floatingName">任务记录</label>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="modal-footer">
                                                            <button type="reset" class="btn btn-secondary" data-bs-dismiss="modal">返回</button>
                                                            <button type="submit" class="btn btn-primary">提交</button>
                                                            <a asp-action="DeleteMission" class="btn btn-danger" asp-route-id="@mission.Id">删除</a>
                                                        </div>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                </div>
                <!-- AddModal -->
                <div class="modal fade bs-example-modal-lg" id="addModal" tabindex="-1" aria-labelledby="addModalLabel"
                     aria-hidden="true">
                    <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
                        <div class="modal-body">
                            <div class="container-fluid">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="addModalLabel">添加任务</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <form class="needs-validation" novalidate="" asp-action="AddMission" method="post">
                                            <div class="form-group row">
                                                <label asp-for="@Model.AddMission.Name" class="col-sm-2"></label>
                                                <div class="col-sm-10">
                                                    <input type="text" class="form-control" asp-for="@Model.AddMission.Name" required>
                                                    <div class="invalid-feedback">请输入任务的名称</div>
                                                </div>
                                            </div>
                                            <br />
                                            <div class="form-group row">
                                                <input asp-for="@Model.AddMission.ProjectId" value="@Model.CurProject.Id" hidden />
                                                <label asp-for="@Model.AddMission.ProjectName" class="col-sm-2"></label>
                                                <div class="col-sm-10">
                                                    <input type="text" value="@Model.CurProject" class="form-control" asp-for="@Model.AddMission.ProjectName" readonly>
                                                    <div class="invalid-feedback">请输入任务的所属项目</div>
                                                </div>
                                            </div>
                                            <br />
                                            <div class="form-group row">
                                                <label asp-for="@Model.AddMission.Description" class="col-sm-2"></label>
                                                <div class="col-sm-10">
                                                    <textarea asp-for="@Model.AddMission.Description" class="form-control" aria-label="With textarea"></textarea>
                                                    <span class="invalid" asp-validation-for="@Model.AddMission.Description"></span>
                                                </div>
                                            </div>
                                            <br />
                                            <div class="form-group row">
                                                <label asp-for="@Model.AddMission.Deadline" class="col-sm-2"></label>
                                                <div class="col-sm-10">
                                                    <input class="form-control" asp-for="@Model.AddMission.Deadline" value="@DateTime.Now.ToString("yyyy-MM-dd")" required="">
                                                    <div class="invalid-feedback">请输入任务的截止日期</div>
                                                </div>
                                            </div>
                                            <br />
                                            <div class="form-group row">
                                                <label asp-for="@Model.AddMission.Status" class="col-sm-2"></label>
                                                <div class="col-sm-10">
                                                    <select asp-for=@Model.AddMission.Status asp-items="@Html.GetEnumSelectList<MissionStatus>()" class="form-control valid">
                                                    </select>
                                                    <span class="invalid" asp-validation-for="@Model.AddMission.Status"></span>
                                                </div>
                                            </div>
                                            <br />
                                            <div class="form-group row">
                                                <label asp-for="@Model.AddMission.Priority" class="col-sm-2"></label>
                                                <div class="col-sm-10">
                                                    <select asp-for="@Model.AddMission.Priority" asp-items="@Html.GetEnumSelectList<MissionPriority>()" class="form-control valid">
                                                    </select>
                                                    <span class="invalid" asp-validation-for="@Model.AddMission.Priority"></span>
                                                </div>
                                            </div>
                                            <br />
                                            <div class="form-group row">
                                                <label asp-for="@Model.AddMission.Executors" class="col-sm-2"></label>
                                                <div class="col-sm-10">
                                                    <select asp-for=@Model.AddMission.Executors class="selectpicker form-control valid" data-live-search="true" multiple required="">
                                                        @foreach (var item in Model.UsersInTheProject.Select(a => a.UserName))
                                                        {
                                                            <option value="@item">@item</option>
                                                        }
                                                    </select>
                                                    <div class="invalid-feedback">请选择执行人</div>
                                                </div>
                                            </div>
                                            <br />
                                            <div class="modal-footer">
                                                <button type="reset" class="btn btn-secondary" data-bs-dismiss="modal">返回</button>
                                                <button type="submit" class="btn btn-primary">提交</button>
                                            </div>
                                        </form>
                                    </div>


                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="tab-pane fade" id="bordered-risks" role="tabpanel" aria-labelledby="risk-tab">
                <div class="container">
                    <div class="form-group row">
                        <div class="text-end">
                            <a asp-action="AddRisk" asp-controller="Risk" asp-route-projectId="@Model.CurProject.Id" class="btn btn-primary text-end">新风险</a>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12 col-md-6 col-lg">
                            <h4 class="mb-3">审核中(@Model.UnCheckRiskViewModels.Count())</h4>
                            @foreach (var risk in Model.UnCheckRiskViewModels)
                            {
                                var st = "border-danger";
                                var ss = "text-danger";
                                if (risk.Level == RiskLevel.低风险)
                                {
                                    st = "border-info";
                                    ss = "text-info";
                                }

                                if (risk.Level == RiskLevel.中风险)
                                {
                                    st = "border-warning";
                                    ss = "text-warning";
                                }

                                <div class="card @st mb-3">
                                    <div class="card-body @ss">
                                        <h5 class="card-title @ss">@risk.Name</h5>
                                        <p class="card-text">@risk.Incidence</p>
                                        <a asp-action="EditRisk" asp-controller="Risk" asp-route-riskId="@risk.Id" class="btn btn-outline-primary">详情</a>
                                    </div>
                                </div>
                            }
                        </div>
                        <div class="col-12 col-md-6 col-lg">
                            <h4 class="mb-3">待处理(@Model.UnDealRiskViewModels.Count())</h4>
                            @foreach (var risk in Model.UnDealRiskViewModels)
                            {
                                var st = "border-danger";
                                var ss = "text-danger";
                                if (risk.Level == RiskLevel.低风险)
                                {
                                    st = "border-info";
                                    ss = "text-info";
                                }

                                if (risk.Level == RiskLevel.中风险)
                                {
                                    st = "border-warning";
                                    ss = "text-warning";
                                }

                                <div class="card @st mb-3">
                                    <div class="card-body @ss">
                                        <h5 class="card-title @ss">@risk.Name</h5>
                                        <p class="card-text">@risk.Incidence</p>
                                        <a asp-action="EditRisk" asp-controller="Risk" asp-route-riskId="@risk.Id" class="btn btn-outline-primary">详情</a>
                                    </div>
                                </div>
                            }
                        </div>
                        <div class="col-12 col-md-6 col-lg">
                            <h4 class="mb-3">已解决(@Model.SettledRiskViewModels.Count())</h4>
                            @foreach (var risk in Model.SettledRiskViewModels)
                            {
                                var st = "border-danger";
                                var ss = "text-danger";
                                if (risk.Level == RiskLevel.低风险)
                                {
                                    st = "border-info";
                                    ss = "text-info";
                                }

                                if (risk.Level == RiskLevel.中风险)
                                {
                                    st = "border-warning";
                                    ss = "text-warning";
                                }

                                <div class="card @st mb-3">
                                    <div class="card-body @ss">
                                        <h5 class="card-title @ss">@risk.Name</h5>
                                        <p class="card-text">@risk.Incidence</p>
                                        <a asp-action="EditRisk" asp-controller="Risk" asp-route-riskId="@risk.Id" class="btn btn-outline-primary">详情</a>
                                    </div>
                                </div>
                            }
                        </div>
                        <div class="col-12 col-md-6 col-lg">
                            <h4 class="mb-3">已丢弃(@Model.DiscardedRiskViewModels.Count())</h4>
                            @foreach (var risk in Model.DiscardedRiskViewModels)
                            {
                                var st = "border-danger";
                                var ss = "text-danger";
                                if (risk.Level == RiskLevel.低风险)
                                {
                                    st = "border-info";
                                    ss = "text-info";
                                }

                                if (risk.Level == RiskLevel.中风险)
                                {
                                    st = "border-warning";
                                    ss = "text-warning";
                                }

                                <div class="card @st mb-3">
                                    <div class="card-body @ss">
                                        <h5 class="card-title @ss">@risk.Name</h5>
                                        <p class="card-text">@risk.Incidence</p>
                                        <a asp-action="EditRisk" asp-controller="Risk" asp-route-riskId="@risk.Id" class="btn btn-outline-primary">详情</a>
                                    </div>
                                </div>
                            }
                        </div>
                    </div>

                </div>
            </div>
            <div class="tab-pane fade" id="bordered-defects" role="tabpanel" aria-labelledby="defect-tab">
                <div class="container">
                    <h5 class="card-title">缺陷列表</h5>
                    <div class="form-group row">
                        <div class="text-end">
                            <a asp-action="AddDefect" asp-controller="Defect" asp-route-projectId="@Model.CurProject.Id" class="btn btn-primary text-end">新缺陷</a>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <!-- Card 1 -->
                            <div class="card mt-3" style="height:50px;">
                                <div class="custom-card-body">
                                    <table class="table table-borderless mb-0">
                                        <tbody>
                                            <tr>
                                                <td class="custom-td">#</td>
                                                <td class="custom-td">名称</td>
                                                <td class="custom-td">类型</td>
                                                <td class="custom-td">状态</td>
                                                <td class="custom-td">操作</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            @foreach (var defect in Model.DefectEditViewModels)
                            {
                                var st = "btn btn-info";
                                if (defect.Status == DefectStatus.待处理)
                                    st = "btn btn-secondary";
                                if (defect.Status == DefectStatus.已解决)
                                    st = "btn btn-success";
                                if (defect.Status == DefectStatus.已丢弃)
                                    st = "btn btn-danger";
                                <div class="card mt-3" data-searchable>
                                    <div class="custom-card-body">
                                        <table class="table table-borderless mb-0">
                                            <tbody>
                                                <tr>
                                                    <td class="custom-td">@defect.Id</td>
                                                    <td class="custom-td">@defect.Name</td>
                                                    <td class="custom-td">
                                                        <label class="btn btn-secondary">@defect.Type</label>
                                                    </td>
                                                    <td class="custom-td">
                                                        <label class="@st">@defect.Status</label>
                                                    <td class="custom-td"><a asp-action="EditDefect" asp-controller="Defect" asp-route-Id="@defect.Id">编辑</a></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                </div>
            </div>
            <div class="tab-pane fade" id="bordered-checks" role="tabpanel" aria-labelledby="check-tab">
                <div class="container">
                    <!-- Default Accordion -->
                    <div class="accordion" id="accordionExample">
                        <div class="accordion-item" id="missionaccordion-item">
                            <h2 class="accordion-header" id="headingOne">
                                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                                    任务审核
                                </button>
                            </h2>
                            <div id="collapseOne" class="accordion-collapse collapse" aria-labelledby="headingOne" data-bs-parent="#accordionExample">
                                <div class="accordion-body">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th scope="col">id</th>
                                                <th scope="col">名称</th>
                                                <th scope="col">状态</th>
                                                <th scope="col">操作</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (var missionCheck in Model.CheckIndexViewModel.MissionChecks)
                                            {
                                                var co = "btn btn-success";
                                                if (missionCheck.Status == CheckStatus.未审核)
                                                    co = "btn btn-info";
                                                if (missionCheck.Status == CheckStatus.再次审核)
                                                    co = "btn btn-secondary";
                                                <tr>
                                                    <th>@missionCheck.Id</th>
                                                    <td>@missionCheck.Name</td>
                                                    <td>
                                                        <label class="@co">@missionCheck.Status</label>
                                                    </td>
                                                    <td>
                                                        <a asp-action="CheckMission" asp-controller="Check" asp-route-id="@missionCheck.Id" class="btn btn-outline-primary">详情</a>
                                                        @if (missionCheck.Status != CheckStatus.审核通过)
                                                        {
                                                            <a asp-action="PassMission" asp-controller="Check" asp-route-id="@missionCheck.Id" class="btn btn-outline-success">通过</a>
                                                        }
                                                        @if (missionCheck.Status != CheckStatus.审核未通过)
                                                        {
                                                            <a asp-action="UnPassMission" asp-controller="Check" asp-route-id="@missionCheck.Id" class="btn btn-outline-danger">未通过</a>
                                                        }
                                                    </td>
                                                </tr>
                                            }

                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item" id="defectaccordion-item">
                            <h2 class="accordion-header" id="headingTwo">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                                    缺陷审核
                                </button>
                            </h2>
                            <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#accordionExample">
                                <div class="accordion-body">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th scope="col">id</th>
                                                <th scope="col">名称</th>
                                                <th scope="col">状态</th>
                                                <th scope="col">操作</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (var defectCheck in Model.CheckIndexViewModel.DefectChecks)
                                            {
                                                var co = "btn btn-success";
                                                if (defectCheck.Status == CheckStatus.未审核)
                                                    co = "btn btn-info";
                                                if (defectCheck.Status == CheckStatus.再次审核)
                                                    co = "btn btn-secondary";
                                                if (defectCheck.Status == CheckStatus.审核未通过)
                                                    co = "btn btn-danger";
                                                <tr>
                                                    <th>@defectCheck.Id</th>
                                                    <td>@defectCheck.Name</td>
                                                    <td>
                                                        <label class="@co">@defectCheck.Status</label>
                                                    </td>
                                                    <td>
                                                        <a asp-action="CheckDefect" asp-controller="Check" asp-route-id="@defectCheck.Id" class="btn btn-outline-primary">详情</a>
                                                        @if (defectCheck.Status != CheckStatus.审核通过)
                                                        {
                                                            <a asp-action="PassDefect" asp-controller="Check" asp-route-id="@defectCheck.Id" class="btn btn-outline-success">通过</a>
                                                        }
                                                        @if (defectCheck.Status != CheckStatus.审核未通过)
                                                        {
                                                            <a asp-action="UnPassDefect" asp-controller="Check" asp-route-id="@defectCheck.Id" class="btn btn-outline-danger">未通过</a>
                                                        }
                                                    </td>
                                                </tr>
                                            }

                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item" id="riskaccordion-item">
                            <h2 class="accordion-header" id="headingThree">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                                    风险审核
                                </button>
                            </h2>
                            <div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree" data-bs-parent="#accordionExample">
                                <div class="accordion-body">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th scope="col">id</th>
                                                <th scope="col">名称</th>
                                                <th scope="col">状态</th>
                                                <th scope="col">操作</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (var riskCheck in Model.CheckIndexViewModel.RiskChecks)
                                            {
                                                var co = "btn btn-success";
                                                if (riskCheck.Status == CheckStatus.未审核)
                                                    co = "btn btn-info";
                                                if (riskCheck.Status == CheckStatus.再次审核)
                                                    co = "btn btn-secondary";
                                                if (riskCheck.Status == CheckStatus.审核未通过)
                                                    co = "btn btn-danger";
                                                <tr>
                                                    <th>@riskCheck.Id</th>
                                                    <td>@riskCheck.Name</td>
                                                    <td>
                                                        <label class="@co">@riskCheck.Status</label>
                                                    </td>
                                                    <td>
                                                        <a asp-action="CheckRisk" asp-controller="Check" asp-route-id="@riskCheck.Id" class="btn btn-outline-primary">详情</a>
                                                        @if (riskCheck.Status != CheckStatus.审核通过)
                                                        {
                                                            <a asp-action="PassRisk" asp-controller="Check" asp-route-id="@riskCheck.Id" class="btn btn-outline-success">通过</a>
                                                        }
                                                        @if (riskCheck.Status != CheckStatus.审核未通过)
                                                        {
                                                            <a asp-action="UnPassRisk" asp-controller="Check" asp-route-id="@riskCheck.Id" class="btn btn-outline-danger">未通过</a>
                                                        }
                                                    </td>
                                                </tr>
                                            }

                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div><!-- End Default Accordion Example -->
                </div>
            </div>
            <div class="tab-pane fade" id="bordered-books" role="tabpanel" aria-labelledby="book-tab">
                <div class="row">
                    <div class="text-end">
                        <a class="btn btn-outline-primary" asp-action="AddBook" asp-controller="Book" asp-route-projectId="@Model.CurProject.Id">添加文档</a>
                    </div>
                </div>
                <br>
                <div class="row row-cols-1 row-cols-md-3 g-4">
                    @foreach (var book in Model.BookIndexViewModels)
                    {
                        <div class="col">
                            <div class="card h-100">
                                <img src="@book.CoverImage" style="width: 100%; height: 200px;" class="card-img-top" alt="...">
                                <div class="card-body">
                                    <h5 class="card-title text-center">@book.Name</h5>
                                    <p class="card-text">@book.Summary</p>
                                </div>
                                <div class="card-footer text-center">
                                    <a asp-action="EditBook" asp-controller="Book" asp-route-id="@book.Id" class="btn btn-primary">查看</a>
                                    <a asp-action="DeleteBook" asp-controller="Book" asp-route-id="@book.Id" class="btn btn-danger">删除</a>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </div>
            <div class="tab-pane fade" id="bordered-resources" role="tabpanel" aria-labelledby="resource-tab">
                <div class="container">
                    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-4 g-4">
                        <!-- 资金 Card -->
                        <div class="col">
                            <div class="card info-card">
                                <div class="card-body">
                                    <h5 class="card-title">资金</h5>
                                    <div class="d-flex align-items-center">
                                        <div class="card-icon-blue rounded-circle d-flex align-items-center justify-content-center">
                                            <i class="bi bi-currency-yen"></i>
                                        </div>
                                        <div class="ps-3">
                                            <h4>@Model.FundIndexViewModel.Amount</h4>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div><!-- End 资金 Card -->
                        <!-- 收入 Card -->
                        <div class="col">
                            <div class="card info-card">
                                <div class="card-body">
                                    <h5 class="card-title">收入</h5>
                                    <div class="d-flex align-items-center">
                                        <div class="card-icon-green rounded-circle d-flex align-items-center justify-content-center">
                                            <i class="bi bi-currency-yen"></i>
                                        </div>
                                        <div class="ps-3">
                                            <h4>@Model.FundIndexViewModel.Income</h4>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div><!-- End 收入 Card -->
                        <!-- 支出 Card -->
                        <div class="col">
                            <div class="card  info-card">
                                <div class="card-body">
                                    <h5 class="card-title">支出</h5>
                                    <div class="d-flex align-items-center">
                                        <div class="card-icon-red rounded-circle d-flex align-items-center justify-content-center">
                                            <i class="bi bi-currency-yen"></i>
                                        </div>
                                        <div class="ps-3">
                                            <h4>@Model.FundIndexViewModel.Paid</h4>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div><!-- End 支出 Card -->
                        <!-- 新增收入/支出 Card -->
                        <div class="col">
                            <div class="card info-card" style="height:83%">
                                <div class="card-body d-flex flex-column">
                                    <div class="d-grid gap-2 mt-auto">
                                        <button type="button" class="btn btn-outline-success" data-bs-toggle="modal" data-bs-target="#addFund">新增收入</button>
                                        <div class="modal fade" id="addFund" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                            <div class="modal-dialog">
                                                <div class="modal-content">
                                                    <form asp-action="AddFund" asp-controller="Fund" method="post">
                                                        <div class="modal-header">
                                                            <h1 class="modal-title fs-5" id="exampleModalLabel">新增收入</h1>
                                                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                        </div>
                                                        <div class="modal-body">
                                                            <div class="container-fluid">
                                                                <div class="form-group row">
                                                                    <input asp-for="@Model.AddFundViewModel.FundId" value="@Model.FundIndexViewModel.Id" hidden>
                                                                </div>
                                                                <br>
                                                                <div class="form-group row">
                                                                    <label class="col-sm-2">金额</label>
                                                                    <div class="col-sm-10">
                                                                        <input type="number" class="form-control" asp-for="@Model.AddFundViewModel.Number">
                                                                        <div class="invalid-feedback"></div>
                                                                    </div>
                                                                </div>
                                                                <br>
                                                                <div class="form-group row">
                                                                    <label class="col-sm-2">说明</label>
                                                                    <div class="col-sm-10">
                                                                        <input type="text" class="form-control" asp-for="@Model.AddFundViewModel.Description">
                                                                        <div class="invalid-feedback"></div>
                                                                    </div>
                                                                    <br>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="modal-footer">
                                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">返回</button>
                                                            <button type="submit" class="btn btn-primary">添加</button>
                                                        </div>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                        <button type="button" class="btn btn-outline-danger" data-bs-toggle="modal" data-bs-target="#useFund">新增支出</button>
                                        <div class="modal fade" id="useFund" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                            <div class="modal-dialog">
                                                <div class="modal-content">
                                                    <form asp-action="UseFund" asp-controller="Fund" method="post">
                                                        <div class="modal-header">
                                                            <h1 class="modal-title fs-5" id="exampleModalLabel">新增支出</h1>
                                                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                        </div>
                                                        <div class="modal-body">
                                                            <div class="container-fluid">
                                                                <div class="form-group row">
                                                                    <input asp-for="@Model.UseFundViewModel.FundId" value="@Model.FundIndexViewModel.Id" hidden>
                                                                </div>
                                                                <br>
                                                                <div class="form-group row">
                                                                    <label class="col-sm-2">金额</label>
                                                                    <div class="col-sm-10">
                                                                        <input type="number" class="form-control" asp-for="@Model.UseFundViewModel.Number" max="@Model.FundIndexViewModel.Amount">
                                                                        <div class="invalid-feedback"></div>
                                                                    </div>
                                                                </div>
                                                                <br>
                                                                <div class="form-group row">
                                                                    <label class="col-sm-2">说明</label>
                                                                    <div class="col-sm-10">
                                                                        <input type="text" class="form-control" asp-for="@Model.UseFundViewModel.Description">
                                                                        <div class="invalid-feedback"></div>
                                                                    </div>
                                                                    <br>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="modal-footer">
                                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">返回</button>
                                                            <button type="submit" class="btn btn-primary">添加</button>
                                                        </div>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div><!-- End 新增收入/支出 Card -->
                    </div>



                    <section class="section">
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="card">
                                    <div class="card-body">
                                        <div class="row">
                                            <h5 class="card-title">资源列表</h5>
                                            <div class="form-group row">
                                                <div class="text-end">
                                                    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addResourceModal">添加资源</button>
                                                    <div class="modal fade" id="addResourceModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                                        <div class="modal-dialog">
                                                            <div class="modal-content">
                                                                <form asp-controller="Resource" asp-action="InitResource" enctype="multipart/form-data" method="post">
                                                                    <div class="modal-header">
                                                                        <h1 class="modal-title fs-5" id="exampleModalLabel">添加资源</h1>
                                                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                                    </div>
                                                                    <div class="modal-body">
                                                                        <div class="container-fluid">
                                                                            <div class="form-group row">
                                                                                <input asp-for="@Model.ResourceAddViewModel.ProjectId" value="@Model.CurProject.Id" hidden>
                                                                                <label asp-for="@Model.ResourceAddViewModel.Name" class="col-sm-2"></label>
                                                                                <div class="col-sm-10">
                                                                                    <input type="text" class="form-control" asp-for="@Model.ResourceAddViewModel.Name" required>
                                                                                    <div class="invalid-feedback"></div>
                                                                                </div>
                                                                            </div>
                                                                            <br>
                                                                            <div class="form-group row">
                                                                                <label asp-for="@Model.ResourceAddViewModel.Image" class="col-sm-2"></label>
                                                                                <div class="col-sm-10">
                                                                                    <input type="file" class="form-control" asp-for="@Model.ResourceAddViewModel.Image" onchange="previewImage(this)">
                                                                                    <img id="coverImagePreview" alt="封面预览" class="img-thumbnail mt-2" style="height:100px;width:auto; display:none;">
                                                                                    <div class="invalid-feedback"></div>
                                                                                </div>
                                                                            </div>
                                                                            <br>
                                                                            <div class="form-group row">
                                                                                <label asp-for="@Model.ResourceAddViewModel.Description" class="col-sm-2"></label>
                                                                                <div class="col-sm-10">
                                                                                    <input type="text" class="form-control" asp-for="@Model.ResourceAddViewModel.Description" required>
                                                                                    <div class="invalid-feedback"></div>
                                                                                </div>
                                                                            </div>
                                                                            <br>
                                                                            <div class="form-group row">
                                                                                <label asp-for="@Model.ResourceAddViewModel.Number" class="col-sm-2"></label>
                                                                                <div class="col-sm-10">
                                                                                    <input type="number" class="form-control" asp-for="@Model.ResourceAddViewModel.Number" required>
                                                                                    <div class="invalid-feedback"></div>
                                                                                </div>
                                                                            </div>
                                                                            <br>
                                                                        </div>
                                                                    </div>
                                                                    <div class="modal-footer">
                                                                        <button type="reset" class="btn btn-secondary" data-bs-dismiss="modal">返回</button>
                                                                        <button type="submit" class="btn btn-primary">保存</button>
                                                                    </div>
                                                                </form>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <table class="table datatable">
                                            <thead>
                                                <tr>
                                                    <th scope="col">#</th>
                                                    <th scope="col">名称</th>
                                                    <th scope="col">图片</th>
                                                    <th scope="col">描述</th>
                                                    <th scope="col">数量</th>
                                                    <th scope="col">操作</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                @foreach (var resource in Model.ResourceIndexViewModels)
                                                {
                                                    <tr>
                                                        <th scope="row">@resource.Id</th>
                                                        <td>@resource.Name</td>
                                                        <td>
                                                            <img src="@resource.ImagePath" alt="没有图片" style="width:100px; height:100px">
                                                        </td>
                                                        <td>@resource.Description</td>
                                                        <td>@resource.Number</td>
                                                        <td>
                                                            <button type="button" class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#useResource@(resource.Id)">使用</button>
                                                            <div class="modal fade" id="useResource@(resource.Id)" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                                                <div class="modal-dialog">
                                                                    <div class="modal-content">
                                                                        <form asp-action="UseResource" asp-controller="Resource" method="post">
                                                                            <div class="modal-header">
                                                                                <h1 class="modal-title fs-5" id="exampleModalLabel">使用资源</h1>
                                                                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                                            </div>
                                                                            <div class="modal-body">
                                                                                <div class="container-fluid">
                                                                                    <div class="form-group row">
                                                                                        <input asp-for="@Model.UseResourceViewModel.ProjectId" value="@Model.CurProject.Id" hidden>
                                                                                        <input asp-for="@Model.UseResourceViewModel.ResourceId" value="@resource.Id" hidden>
                                                                                        <label class="col-sm-2">名称</label>
                                                                                        <div class="col-sm-10">
                                                                                            <input type="text" class="form-control" value="@resource.Name" readonly>
                                                                                            <div class="invalid-feedback"></div>
                                                                                        </div>
                                                                                    </div>
                                                                                    <br>
                                                                                    <div class="form-group row">
                                                                                        <label class="col-sm-2">数量</label>
                                                                                        <div class="col-sm-10">
                                                                                            <input type="number" class="form-control" asp-for="@Model.UseResourceViewModel.Number" max="@resource.Number">
                                                                                            <div class="invalid-feedback"></div>
                                                                                        </div>
                                                                                    </div>
                                                                                    <br>
                                                                                    <div class="form-group row">
                                                                                        <label class="col-sm-2">说明</label>
                                                                                        <div class="col-sm-10">
                                                                                            <input type="text" class="form-control" asp-for="@Model.UseResourceViewModel.Description">
                                                                                            <div class="invalid-feedback"></div>
                                                                                        </div>
                                                                                        <br>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                            <div class="modal-footer">
                                                                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">返回</button>
                                                                                <button type="submit" class="btn btn-primary">使用</button>
                                                                            </div>
                                                                        </form>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <button type="button" class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#addResource@(resource.Id)">添加</button>
                                                            <div class="modal fade" id="addResource@(resource.Id)" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                                                <div class="modal-dialog">
                                                                    <div class="modal-content">
                                                                        <form asp-action="AddResource" asp-controller="Resource" method="post">
                                                                            <div class="modal-header">
                                                                                <h1 class="modal-title fs-5" id="exampleModalLabel">添加资源</h1>
                                                                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                                            </div>
                                                                            <div class="modal-body">
                                                                                <div class="container-fluid">
                                                                                    <div class="form-group row">
                                                                                        <input asp-for="@Model.AddResourceViewModel.ProjectId" value="@Model.CurProject.Id" hidden>
                                                                                        <input asp-for="@Model.AddResourceViewModel.ResourceId" value="@resource.Id" hidden>
                                                                                        <label class="col-sm-2">名称</label>
                                                                                        <div class="col-sm-10">
                                                                                            <input type="text" class="form-control" value="@resource.Name" readonly>
                                                                                            <div class="invalid-feedback"></div>
                                                                                        </div>
                                                                                    </div>
                                                                                    <br>
                                                                                    <div class="form-group row">
                                                                                        <label class="col-sm-2">数量</label>
                                                                                        <div class="col-sm-10">
                                                                                            <input type="number" class="form-control" asp-for="@Model.AddResourceViewModel.Number">
                                                                                            <div class="invalid-feedback"></div>
                                                                                        </div>
                                                                                    </div>
                                                                                    <br>
                                                                                    <div class="form-group row">
                                                                                        <label class="col-sm-2">说明</label>
                                                                                        <div class="col-sm-10">
                                                                                            <input type="text" class="form-control" asp-for="@Model.AddResourceViewModel.Description">
                                                                                            <div class="invalid-feedback"></div>
                                                                                        </div>
                                                                                        <br>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                            <div class="modal-footer">
                                                                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">返回</button>
                                                                                <button type="submit" class="btn btn-primary">添加</button>
                                                                            </div>
                                                                        </form>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <button type="button" class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#lookResource@(resource.Id)">查看记录</button>
                                                            <div class="modal fade" id="lookResource@(resource.Id)" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                                                <div class="modal-dialog">
                                                                    <div class="modal-content">
                                                                        <form asp-action="AddResource" asp-controller="Resource" method="post">
                                                                            <div class="modal-header">
                                                                                <h1 class="modal-title fs-5" id="exampleModalLabel">资源记录</h1>
                                                                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                                            </div>
                                                                            <div class="modal-body">
                                                                                <div class="container-fluid">
                                                                                    <ul class="list-group list-group-flush">
                                                                                        @foreach (var change in resource.ResourceChanges)
                                                                                        {
                                                                                            <li class="list-group-item">
                                                                                                <p6>@change.Time</p6>
                                                                                                <label>@change.User.UserName @change.Description @change.Number 个 @change.Resource.Name 描述：@change.Reason</label>
                                                                                            </li>
                                                                                        }
                                                                                    </ul>
                                                                                </div>
                                                                            </div>
                                                                            <div class="modal-footer">
                                                                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">返回</button>
                                                                            </div>
                                                                        </form>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <a asp-action="DeleteResource" asp-controller="Resource" asp-route-id="@resource.Id" class="btn btn-outline-danger">删除</a>
                                                        </td>

                                                    </tr>
                                                }
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Recent Activity -->
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">资金记录</h5>
                            <div class="activity">
                                @foreach (var fundChange in Model.FundIndexViewModel.Changes)
                                {
                                    <div class="activity-item d-flex">
                                        <div class="time-container">
                                            <div class="activite-label">@fundChange.DateTime</div>
                                        </div>
                                        @{
                                            var c = "text-danger";
                                            if (fundChange.ChangeType == FundChangeType.收入)
                                                c = "text-success";
                                        }
                                        <i class='bi bi-circle-fill activity-badge @c align-self-start'></i>
                                        <div class="activity-content">
                                            @fundChange.User.UserName @fundChange.ChangeType.ToString() @fundChange.Number 说明：@fundChange.Description
                                        </div>
                                    </div>
                                }
                            </div>
                        </div>
                    </div><!-- End Recent Activity -->
                </div>
            </div>
            <div class="tab-pane fade" id="bordered-users" role="tabpanel" aria-labelledby="user-tab">
                <div class="container">
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="card">
                                <div class="card-body">
                                    <div class="row">
                                        <h5 class="card-title">项目人员</h5>
                                    </div>
                                    <div class="row">
                                        <div class="card">
                                        </div>
                                        <div class="col-md-6">
                                            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addUserModal">
                                                添加人员
                                            </button>
                                        </div>
                                        <div class="col-md-6">
                                            <input class="form-control mt-2 float-right" id="searchInput" type="text" placeholder="搜索...">
                                        </div>
                                        <div class="modal fade" id="addUserModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                            <div class="modal-dialog">
                                                <div class="modal-content">
                                                    <div class="modal-header">
                                                        <h5 class="modal-title" id="exampleModalLabel">添加人员</h5>
                                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                    </div>
                                                    <form method="post" asp-action="AddUserToProject">
                                                        <div class="modal-body">
                                                            <div class="modal-body">
                                                                <input type="text" class="form-control" placeholder="输入用户名进行搜索" id="searchuser">
                                                                <hr>
                                                                <table class="table table-striped">
                                                                    <thead>
                                                                        <tr>
                                                                            <th>用户名</th>
                                                                            <th>角色</th>
                                                                            <th>部门</th>
                                                                            <th>职位</th>
                                                                            <th>添加</th>
                                                                        </tr>
                                                                    </thead>
                                                                    <tbody>
                                                                        @for (int i = 0; i < Model.UsersNotInThisProject.Count; i++)
                                                                        {
                                                                            var user = Model.UsersNotInThisProject[i];
                                                                            <tr>
                                                                                <input asp-for="@Model.UsersNotInThisProject[i].Id" value="@Model.UsersNotInThisProject[i].Id" hidden>
                                                                                <input asp-for="@Model.CurProjectId" value="@Model.CurProject.Id" hidden>
                                                                                <td>@user.Name</td>
                                                                                <td>@user.RoleName</td>
                                                                                <td>@user.Department</td>
                                                                                <td>@user.Job</td>
                                                                                <td>
                                                                                    <div class="form-check">
                                                                                        <input type="checkbox" class="form-check-input" asp-for="@Model.UsersNotInThisProject[i].IsSelected" )>
                                                                                    </div>
                                                                                </td>
                                                                            </tr>
                                                                        }
                                                                    </tbody>
                                                                </table>
                                                            </div>
                                                        </div>
                                                        <div class="modal-footer">
                                                            <button type="reset" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                                                            <button type="submit" class="btn btn-primary">添加</button>
                                                        </div>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 下面是之前的卡片表格代码 -->
                                    <div class="row">
                                        <div class="col">
                                            <!-- Card 1 -->
                                            <div class="card mt-3" style="height:60px;">
                                                <div class="custom-card-body">
                                                    <table class="table table-borderless mb-0">
                                                        <tbody>
                                                            <tr>
                                                                <td class="custom-td">用户</td>
                                                                <td class="custom-td">角色</td>
                                                                <td class="custom-td">部门</td>
                                                                <td class="custom-td">岗位</td>
                                                                <td class="custom-td">操作</td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                            @foreach (var user in Model.ProjectUserIndexViewModels)
                                            {
                                                <div class="card mt-3" data-searchable>
                                                    <div class="custom-card-body">
                                                        <table class="table table-borderless mb-0">
                                                            <tbody>
                                                                <tr>
                                                                    <td class="custom-td">@user.Name</td>
                                                                    <td class="custom-td">@user.RoleName</td>
                                                                    <td class="custom-td">@user.Department</td>
                                                                    <td class="custom-td">@user.Job</td>
                                                                    <td class="custom-td"><a asp-action="DeleteUserFromProject" asp-controller="User" asp-route-userId="@user.Id" asp-route-PROJECTId="@Model.CurProject.Id" class="btn btn-outline-danger" onclick="return confirm('确定要删除风险：@user.Name 吗？');">删除</a></td>
                                                                </tr>
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                            }
                                        </div>
                                    </div>




                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="tab-pane fade" id="bordered-editProject" role="tabpanel" aria-labelledby="project-tab">
                <div class="container">
                    <form asp-action="EditProject" method="post">
                        <div class="form-group row">
                            <input asp-for="ProjectEditViewModel.Id" value="@Model.CurProject.Id" hidden>
                            <label asp-for="ProjectEditViewModel.Name" class="col-sm-2"></label>
                            <div class="col-sm-10">
                                <input asp-for="ProjectEditViewModel.Name" value="@Model.ProjectEditViewModel.Name" class="form-control exchange-element" required disabled>
                                <div class="invalid-feedback">请输入项目名称</div>
                            </div>
                        </div>
                        <br />
                        <div class="form-group row">
                            <label asp-for="ProjectEditViewModel.Description" class="col-sm-2"></label>
                            <div class="col-sm-10">
                                <textarea asp-for="ProjectEditViewModel.Description" class="form-control exchange-element" disabled></textarea>
                            </div>
                        </div>
                        <br />
                        <div class="form-group row">
                            <label asp-for="ProjectEditViewModel.CreatedDate" class="col-sm-2"></label>
                            <div class="col-sm-10">
                                <input asp-for="ProjectEditViewModel.CreatedDate" type="date" value="@Model.ProjectEditViewModel.CreatedDate.ToString("yyyy-MM-dd")" class="form-control exchange-element" disabled>
                            </div>
                        </div>
                        <br />
                        <div class="form-group row">
                            <label asp-for="ProjectEditViewModel.Deadline" class="col-sm-2"></label>
                            <div class="col-sm-10">
                                <input asp-for="ProjectEditViewModel.Deadline" value="@Model.ProjectEditViewModel.Deadline.ToString("yyyy-MM-dd")" class="form-control exchange-element" disabled>
                            </div>
                        </div>
                        <br />
                        <div class="form-group row">
                            <label asp-for="ProjectEditViewModel.Status" class="col-sm-2"></label>
                            <div class="col-sm-10">
                                <select asp-for="ProjectEditViewModel.Status" asp-items="@Html.GetEnumSelectList<ProjectStatus>()" class="form-control exchange-element" disabled></select>
                            </div>
                        </div>
                        <br />
                        <div class="form-group row">
                            <label asp-for="ProjectEditViewModel.PutForward" class="col-sm-2"></label>
                            <div class="col-sm-10">
                                <select asp-for="ProjectEditViewModel.PutForward" asp-items="new SelectList(applicationDbContext.Users.Select(a=>a.UserName))" class="form-control exchange-element" disabled></select>
                            </div>
                        </div>
                        <br />
                        <div class="form-group row">
                            <label asp-for="ProjectEditViewModel.Functionary" class="col-sm-2"></label>
                            <div class="col-sm-10">
                                <select asp-for="ProjectEditViewModel.Functionary" asp-items="new SelectList(applicationDbContext.Users.Select(a=>a.UserName))" class="form-control exchange-element" disabled></select>
                            </div>
                        </div>
                        <br />
                        <div class="col-6 offset-3">
                            <div class="form-group row">
                                <button class="btn btn-primary text-center" id="exchangeBtn">编辑</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <!-- End Bordered Tabs -->

    </div>
</div>

@section Scripts {
    <script type="text/javascript">
        $(document).ready(function () {
            // 初始化select元素
            $('.selectpicker').selectpicker();
        });
    </script>
    <script>
        // 其他代码

        function previewImage(input) {
            if (input.files && input.files[0]) {
                var reader = new FileReader();
                reader.onload = function (e) {
                    var preview = document.getElementById('coverImagePreview');
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                };
                reader.readAsDataURL(input.files[0]);
            }
        }
    </script>
    <script>
        $(document).ready(function () {
            $("#exchangeBtn").click(function (event) {
                event.preventDefault(); // 阻止表单默认提交事件
                var btnText = $(this).text();
                var form = $(this).closest('form');

                if (btnText === "编辑") {
                    $(this).text("保存");
                    $(".exchange-element").prop("disabled", false);
                } else {
                    $(this).text("编辑");
                    $(".exchange-element").prop("disabled", true);

                    // 在提交表单之前启用所有字段，以确保所有数据都包含在请求中
                    $(".exchange-element").prop("disabled", false);

                    // 提交表单
                    form.submit();
                }
            });
        });

    </script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const urlParams = new URLSearchParams(window.location.search);
            const tab = urlParams.get('tab');
            const accordionId = urlParams.get("accordionId");
            if (tab) {
                const tabElement = document.querySelector(`[data-bs-target="#${tab}"]`);
                if (tabElement) {
                    const tabInstance = new bootstrap.Tab(tabElement);
                    tabInstance.show();
                }
            }
            if (accordionId) {
                const accordionElement = document.getElementById(accordionId);
                if (accordionElement) {
                    const accordionInstance = new bootstrap.Collapse(accordionElement, { toggle: true });
                }
            }
        });
    </script>
    <script>
        $(document).ready(function () {
            $("#searchInput").on("keyup", function () {
                let value = $(this).val().toLowerCase();
                $("[data-searchable]").filter(function () {
                    // 在这里，我们搜索每个卡片中表格的文本内容
                    $(this).toggle($(this).find("table").text().toLowerCase().indexOf(value) > -1)
                });
            });
        });
    </script>
    <script>
        $(document).ready(function () {
            $('#searchuser').on('keyup', function () {
                var value = $(this).val().toLowerCase();
                $('table tbody tr').filter(function () {
                    $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
                });
            });
        });

    </script>
    <script>
        function scrollToBottom() {
            var scrollableDiv = document.getElementById("scrollableDiv");
            scrollableDiv.scrollTop = scrollableDiv.scrollHeight;
        }
        document.querySelectorAll(".my-modal").forEach(function (modal) {
            modal.addEventListener("shown.bs.modal", function () {
                var scrollableDivId = this.getAttribute("data-scrollable-div");
                scrollToBottom(scrollableDivId);
            });
        });


    </script>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            new ApexCharts(document.querySelector("#columnChart"), {
                series: [{
                    name: 'Net Profit',
                    data: [44, 55, 57, 56, 61, 58, 63, 60, 66]
                }, {
                    name: 'Revenue',
                    data: [76, 85, 101, 98, 87, 105, 91, 114, 94]
                }, {
                    name: 'Free Cash Flow',
                    data: [35, 41, 36, 26, 45, 48, 52, 53, 41]
                }],
                chart: {
                    type: 'bar',
                    height: 350
                },
                plotOptions: {
                    bar: {
                        horizontal: false,
                        columnWidth: '55%',
                        endingShape: 'rounded'
                    },
                },
                dataLabels: {
                    enabled: false
                },
                stroke: {
                    show: true,
                    width: 2,
                    colors: ['transparent']
                },
                xaxis: {
                    categories: ['Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct'],
                },
                yaxis: {
                    title: {
                        text: '$ (thousands)'
                    }
                },
                fill: {
                    opacity: 1
                },
                tooltip: {
                    y: {
                        formatter: function (val) {
                            return "$ " + val + " thousands"
                        }
                    }
                }
            }).render();
        });
    </script>

    <script>
        $(function () {
            $.get('/Project/GetData', function (data) {
                var options = {
                    series: data,
                    chart: {
                        height: 350,
                        type: 'area'
                    },
                    dataLabels: {
                        enabled: false
                    },
                    stroke: {
                        curve: 'smooth'
                    },
                    xaxis: {
                        type: 'datetime',
                        categories: ["2018-09-19T00:00:00.000Z", "2018-09-19T01:30:00.000Z", "2018-09-19T02:30:00.000Z", "2018-09-19T03:30:00.000Z", "2018-09-19T04:30:00.000Z", "2018-09-19T05:30:00.000Z", "2018-09-19T06:30:00.000Z"]
                    },
                    tooltip: {
                        x: {
                            format: 'dd/MM/yy HH:mm'
                        },
                    },
                };

                var chart = new ApexCharts(document.querySelector("#chart"), options);
                chart.render();
            });
        });
    </script>

    <script>
        //通知已读颜色变浅
        $(document).ready(function () {
            $('.mark-as-read').click(function () {
                $(this).parent().css('opacity', '0.5');
            });
        });
    </script>

    <script>
        //const connection = new signalR.HubConnectionBuilder()
        //    .withUrl("/chathub")
        //    .build();

        //connection.start().then(function () {
        //    document.getElementById("sendButton").addEventListener("click", function (event) {
        //        const user = document.getElementById("userInput").value;
        //        const message = document.getElementById("messageInput").value;
        //        connection.invoke("SendMessageToUser", user, message).catch(function (err) {
        //            return console.error(err.toString());
        //        });
        //        event.preventDefault();
        //    });
        //}).catch(function (err) {
        //    return console.error(err.toString());
        //});

        //// 接收消息
        //connection.on("ReceiveMessage", function (message) {
        //    const li = document.createElement("li");
        //    li.textContent = message;
        //    document.getElementById("messagesList").appendChild(li);
        //});


    </script>

    <script>
    $(document).ready(function () {
        // 创建 SignalR 连接
        var connection = new signalR.HubConnectionBuilder().withUrl("/noticeHub").build();

        // 接收通知
        connection.on("ReceiveNotice", function (notice) {
                console.log('received');
            var coor = "alert-success";
            var ic = "bi bi-check-circle me-1";
            var bt = "btn-success";

            if (notice.NoticeType === "Info") {
                coor = "alert-info";
                ic = "bi bi-info-circle me-1";
                bt = "btn-info";
            } else if (notice.NoticeType === "Warning") {
                coor = "alert-warning";
                ic = "bi bi-exclamation-triangle me-1";
                bt = "btn-warning";
            } else if (notice.NoticeType === "Danger") {
                coor = "alert-danger";
                ic = "bi bi-exclamation-octagon me-1";
                bt = "btn-danger";
            }

            var noticeElement = '<div class="alert ' + coor + ' alert-dismissible fade show notification" role="alert">' +
                '<div class="notification-info">' +
                '<i class="' + ic + '"></i>' +
                notice.Information +
                '</div>' +
                '<button type="button" class="btn ' + bt + ' btn-sm mark-as-read" data-bs-toggle="modal" data-bs-target="#looktz' + notice.Id + '">详情</button>' +
                // 添加通知详情的模态框代码
                '</div>';

            // 将通知元素添加到页面中的通知列表
            $('#notificationList').append(noticeElement);

            // 生成通知详情的模态框代码
            var modalElement = '<div class="modal fade" id="looktz' + notice.Id + '" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">' +
                '<div class="modal-dialog">' +
                '<div class="modal-content">' +
                '<div class="modal-header">' +
                '<h1 class="modal-title fs-5" id="exampleModalLabel">通知详情</h1>' +
                '<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>' +
                '</div>' +
                '<div class="modal-body">' +
                '<textarea>' + notice.Information + '</textarea>' +
                '<label>' + notice.Putforward + '</label>' +
                '<label>' + notice.CreateTime + '</label>' +
                '</div>' +
                '<div class="modal-footer">' +
                '<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭</button>' +
                '</div>' +
                '</div>' +
                '</div>' +
                '</div>';

            // 将模态框代码添加到页面
            $('body').append(modalElement);
        });

        // 启动 SignalR 连接
        connection.start().catch(function (err) {
            console.error(err.toString());
        });
            connection.onclose(function (error) {
                console.log('Connection closed. Error: ', error);
            });

        });
    </script>



    }
